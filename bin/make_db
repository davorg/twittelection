#!/bin/bash

dir=$(dirname "$0")
# shellcheck source=bin/func_defs
. "$dir/func_defs"

check_vars

root_user=$1

# Drop existing database
echo "DROP DATABASE IF EXISTS $TE_DB" | mysql -u$root_user -p

# Create database
echo "CREATE DATABASE $TE_DB" | mysql -u$root_user -p$root_pass

# Create user and permissions
echo "GRANT ALL ON $TE_DB.* TO '$TE_USER'@'localhost' IDENTIFIED BY '$TE_PASS'" | mysql -u$root_user -p$root_pass

# Load DDL
mysql -u$TE_USER -p$TE_PASS -D$TE_DB < db/twittelect.sql

# Load data
mysql -u$TE_USER -p$TE_PASS -D$TE_DB < db/constituency.dat
mysql -u$TE_USER -p$TE_PASS -D$TE_DB < db/party.dat

if [[ -f db/candidate.tsv ]]
then
  bin/load_cand
fi

